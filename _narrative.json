{
  "variables": {
    "day": 1,
    "system_visits": 0,
    "credits": 0,
    "kills": 0,
    "time_period": "morning",
    "lena_met_today": false,
    "victor_met_today": false,
    "marta_met_today": false,
    "emil_met_today": false,
    "lena_interactions": 0,
    "victor_interactions": 0,
    "marta_interactions": 0,
    "emil_interactions": 0,
    "system_revealed": false,
    "curfew_active": false
  },
  "graphs": {
    "arc": {
      "startNode": "routine",
      "nodes": [
        { "id": "routine", "label": "Daily routine", "type": "scene" },
        { "id": "first_system", "label": "First entry", "type": "scene" },
        { "id": "deeper", "label": "Going deeper", "type": "scene" },
        { "id": "revelation", "label": "The truth", "type": "scene" },
        { "id": "curfew", "label": "Caught", "type": "scene" },
        { "id": "eviction", "label": "Evicted", "type": "scene" }
      ],
      "edges": [
        { "from": "routine", "to": "first_system" },
        { "from": "first_system", "to": "deeper" },
        { "from": "deeper", "to": "revelation" },
        { "from": "routine", "to": "curfew" },
        { "from": "routine", "to": "eviction" },
        { "from": "first_system", "to": "curfew" },
        { "from": "first_system", "to": "eviction" },
        { "from": "deeper", "to": "curfew" },
        { "from": "deeper", "to": "eviction" }
      ]
    },
    "quest_lena": {
      "startNode": "stranger",
      "nodes": [
        { "id": "stranger", "label": "Stranger", "type": "state" },
        { "id": "acquaintance", "label": "Acquaintance", "type": "state" },
        { "id": "confidant", "label": "Confidant", "type": "state" }
      ],
      "edges": [
        { "from": "stranger", "to": "acquaintance", "var": "lena_interactions", "gte": 1 },
        { "from": "acquaintance", "to": "confidant", "var": "lena_interactions", "gte": 3 }
      ]
    },
    "quest_victor": {
      "startNode": "stranger",
      "nodes": [
        { "id": "stranger", "label": "Stranger", "type": "state" },
        { "id": "acquaintance", "label": "Acquaintance", "type": "state" },
        { "id": "confidant", "label": "Confidant", "type": "state" }
      ],
      "edges": [
        { "from": "stranger", "to": "acquaintance", "var": "victor_interactions", "gte": 1 },
        { "from": "acquaintance", "to": "confidant", "var": "victor_interactions", "gte": 3 }
      ]
    },
    "quest_marta": {
      "startNode": "stranger",
      "nodes": [
        { "id": "stranger", "label": "Stranger", "type": "state" },
        { "id": "acquaintance", "label": "Acquaintance", "type": "state" },
        { "id": "confidant", "label": "Confidant", "type": "state" }
      ],
      "edges": [
        { "from": "stranger", "to": "acquaintance", "var": "marta_interactions", "gte": 1 },
        { "from": "acquaintance", "to": "confidant", "var": "marta_interactions", "gte": 3 }
      ]
    },
    "quest_emil": {
      "startNode": "stranger",
      "nodes": [
        { "id": "stranger", "label": "Stranger", "type": "state" },
        { "id": "acquaintance", "label": "Acquaintance", "type": "state" },
        { "id": "confidant", "label": "Confidant", "type": "state" }
      ],
      "edges": [
        { "from": "stranger", "to": "acquaintance", "var": "emil_interactions", "gte": 1 },
        { "from": "acquaintance", "to": "confidant", "var": "emil_interactions", "gte": 3 }
      ]
    }
  },
  "needs": {
    "hunger":  { "label": "Hunger",  "decay": 0.1,  "critical": 20 },
    "safety":  { "label": "Safety",  "decay": 0.05, "critical": 10 },
    "social":  { "label": "Social",  "decay": 0.03, "critical": 15 },
    "purpose": { "label": "Purpose", "decay": 0.08, "critical": 25 }
  },
  "jobs": {
    "eat":    { "label": "Eat",    "fulfills": "hunger",  "restore": 50, "duration": 3, "zone": "cafe" },
    "patrol": { "label": "Patrol", "fulfills": "safety",  "restore": 30, "duration": 5 },
    "talk":   { "label": "Talk",   "fulfills": "social",  "restore": 40, "duration": 2 },
    "work":   { "label": "Work",   "fulfills": "purpose", "restore": 45, "duration": 4, "zone": "terminal" },
    "wander": { "label": "Wander", "fulfills": null,      "restore": 0,  "duration": 3 }
  },
  "moods": {
    "saw_combat": -15,
    "had_meal": 5,
    "talked_friend": 10,
    "got_hurt": -20,
    "worked": 3,
    "curfew_near": -10
  },
  "actors": {
    "lena": {
      "name": "Lena", "sprite": "npcs/lena",
      "needs": { "hunger": 80, "social": 60, "safety": 90, "purpose": 70 },
      "priorities": ["talk", "eat", "work", "patrol"]
    },
    "victor": {
      "name": "Victor", "sprite": "npcs/victor",
      "needs": { "hunger": 70, "social": 40, "safety": 80, "purpose": 85 },
      "priorities": ["patrol", "work", "eat", "talk"]
    },
    "marta": {
      "name": "Marta", "sprite": "npcs/marta",
      "needs": { "hunger": 90, "social": 50, "safety": 95, "purpose": 60 },
      "priorities": ["work", "eat", "talk", "patrol"]
    },
    "emil": {
      "name": "Emil", "sprite": "npcs/emil",
      "needs": { "hunger": 60, "social": 30, "safety": 50, "purpose": 40 },
      "priorities": ["wander", "talk", "eat"]
    },
    "drone": { "name": "Drone", "sprite": "enemies/drone", "hp": 8, "atk": 4, "def": 1 },
    "sentinel": { "name": "Sentinel", "sprite": "enemies/sentinel", "hp": 14, "atk": 6, "def": 2 },
    "tracker": { "name": "Tracker", "sprite": "enemies/tracker", "hp": 4, "atk": 5, "def": 0 }
  },
  "scenes": [
    {
      "id": "morning_routine",
      "label": "Morning — NPCs at home/work",
      "condition": { "var": "time_period", "eq": "morning" },
      "cast": [
        { "actor": "lena", "action": "present", "zone": "home", "dialogue": "Another day. Another shift. The rent doesn't wait." },
        { "actor": "marta", "action": "present", "zone": "terminal", "dialogue": "Rent is due. The system is patient but not forgiving." },
        { "actor": "victor", "action": "wander", "zone": "", "dialogue": "" },
        { "actor": "emil", "action": "wander", "zone": "", "dialogue": "" }
      ],
      "effects": []
    },
    {
      "id": "midday_cafe",
      "label": "Midday — NPCs gather at cafe",
      "condition": { "var": "time_period", "eq": "midday" },
      "cast": [
        { "actor": "lena", "action": "sit", "zone": "cafe", "dialogue": "" },
        { "actor": "victor", "action": "sit", "zone": "cafe", "dialogue": "" },
        { "actor": "marta", "action": "present", "zone": "home", "dialogue": "" },
        { "actor": "emil", "action": "wander", "zone": "", "dialogue": "" }
      ],
      "effects": []
    },
    {
      "id": "evening_warning",
      "label": "Evening — curfew approaches",
      "condition": { "var": "time_period", "eq": "evening" },
      "cast": [
        { "actor": "lena", "action": "present", "zone": "home", "dialogue": "" },
        { "actor": "victor", "action": "sit", "zone": "cafe", "dialogue": "" },
        { "actor": "marta", "action": "sit", "zone": "cafe", "dialogue": "" },
        { "actor": "emil", "action": "sit", "zone": "cafe", "dialogue": "" }
      ],
      "effects": [
        { "type": "visual", "name": "timeOfDay_evening" },
        { "type": "message", "text": "Getting late. The drones will activate soon." }
      ]
    },
    {
      "id": "curfew_enforcement",
      "label": "Curfew — drones patrol streets",
      "condition": { "var": "curfew_active", "eq": true },
      "cast": [
        { "actor": "drone", "action": "patrol", "zone": "streets", "count": 12 }
      ],
      "effects": [
        { "type": "visual", "name": "red_alert" }
      ]
    },
    {
      "id": "deeper_trust",
      "label": "Going deeper — NPCs open up",
      "condition": { "node": "arc:deeper" },
      "cast": [
        { "actor": "lena", "action": "follow_player", "zone": "", "dialogue": "Each time you go down there, you come back different. I see it. I don't say it." },
        { "actor": "victor", "action": "present", "zone": "garden", "dialogue": "Each time you go in, it maps you. Learns what you fear. Uses it." },
        { "actor": "marta", "action": "present", "zone": "terminal", "dialogue": "The reports pile up. I file none of them." },
        { "actor": "emil", "action": "wander", "zone": "", "dialogue": "I was like you once. Before I learned that the door was always meant for me." }
      ],
      "effects": [
        { "type": "visual", "name": "corruption" }
      ]
    },
    {
      "id": "confidant_lena",
      "label": "Lena becomes confidant",
      "condition": { "node": "quest_lena:confidant" },
      "cast": [
        { "actor": "lena", "action": "follow_player", "zone": "", "dialogue": "I trust you. The system watches us build trust \u2014 that's the experiment. We are the variable it cannot control." }
      ],
      "effects": []
    },
    {
      "id": "confidant_victor",
      "label": "Victor becomes confidant",
      "condition": { "node": "quest_victor:confidant" },
      "cast": [
        { "actor": "victor", "action": "present", "zone": "terminal", "dialogue": "I've been mapping it. The system. Every visit. It changes, but there's a pattern. Here \u2014 take what I know." }
      ],
      "effects": []
    },
    {
      "id": "confidant_marta",
      "label": "Marta becomes confidant",
      "condition": { "node": "quest_marta:confidant" },
      "cast": [
        { "actor": "marta", "action": "follow_player", "zone": "", "dialogue": "I deleted the reports. All of them. If they ask, I never saw you." }
      ],
      "effects": []
    },
    {
      "id": "confidant_emil",
      "label": "Emil becomes confidant",
      "condition": { "node": "quest_emil:confidant" },
      "cast": [
        { "actor": "emil", "action": "present", "zone": "garden", "dialogue": "The door was always open. We are all doorkeepers. The trial never ends because we are the trial." }
      ],
      "effects": []
    },
    {
      "id": "first_system_entry",
      "label": "First time entering the system",
      "condition": { "node": "arc:first_system" },
      "cast": [],
      "effects": [
        { "type": "cutscene", "id": "first_system" },
        { "type": "visual", "name": "systemCold" }
      ]
    },
    {
      "id": "system_reveal",
      "label": "System entrance becomes accessible",
      "condition": { "var": "day", "gte": 3 },
      "cast": [],
      "effects": [
        { "type": "setVar", "name": "system_revealed", "value": true }
      ]
    },
    {
      "id": "revelation",
      "label": "Reached the source — the truth",
      "condition": { "node": "arc:revelation" },
      "cast": [],
      "effects": [
        { "type": "cutscene", "id": "revelation" }
      ]
    },
    {
      "id": "curfew_caught",
      "label": "Caught outside after curfew",
      "condition": { "node": "arc:curfew" },
      "cast": [],
      "effects": [
        { "type": "cutscene", "id": "curfew" }
      ]
    },
    {
      "id": "eviction",
      "label": "Evicted — cannot pay rent",
      "condition": { "node": "arc:eviction" },
      "cast": [],
      "effects": [
        { "type": "cutscene", "id": "eviction" }
      ]
    }
  ],
  "cutscenes": {
    "wake": {
      "lines": [
        "> DAILY CYCLE INITIATED",
        "",
        "> Time: 06:00",
        "> Status: OPERATIONAL",
        "> Credits: CHECKING...",
        "",
        "> Another day in the block.",
        "> Terminal shift. Rent due.",
        "> Everything as it should be.",
        "",
        "> (Is it?)"
      ],
      "color": "#8af",
      "lineDelay": 200
    },
    "first_system": {
      "lines": [
        "> UNAUTHORIZED ACCESS DETECTED",
        "",
        "> Location: Sub-level 1",
        "> Authorization: NONE",
        "> Threat level: UNKNOWN",
        "",
        "> The maintenance shaft opens",
        "> into something that is not",
        "> maintenance.",
        "",
        "> The walls hum.",
        "> The lights know you're here.",
        "",
        "> You should not be here.",
        "> And yet the door was open."
      ],
      "color": "#4ef",
      "lineDelay": 200
    },
    "ejected": {
      "lines": [
        "> SYSTEM BREACH TERMINATED",
        "",
        "> Hull integrity: CRITICAL",
        "> Location: SURFACE",
        "> Time elapsed: SIGNIFICANT",
        "",
        "> You wake up on the street.",
        "> Your head hurts.",
        "> Your credits are lighter.",
        "",
        "> The entrance is sealed.",
        "> For now.",
        "",
        "> Tomorrow it will open again.",
        "> It always does."
      ],
      "color": "#f80",
      "lineDelay": 200
    },
    "curfew": {
      "lines": [
        "> CURFEW VIOLATION DETECTED",
        "",
        "> Location: OUTSIDE",
        "> Time: AFTER HOURS",
        "> Status: NON-COMPLIANT",
        "",
        "> The drones were patient.",
        "> They gave you warnings.",
        "> You did not listen.",
        "",
        "> Resident status: REVOKED.",
        "",
        "> The system does not punish.",
        "> It processes.",
        "> You have been processed."
      ],
      "color": "#f44",
      "lineDelay": 200
    },
    "eviction": {
      "lines": [
        "> INSUFFICIENT FUNDS",
        "",
        "> Rent due: UNPAID",
        "> Grace period: EXPIRED",
        "> Resident status: TERMINATED",
        "",
        "> You cannot stay.",
        "> You have nowhere to go.",
        "",
        "> The block was not a home.",
        "> It was a term. A condition.",
        "> And conditions can be revoked.",
        "",
        "> Outside, the drones wait.",
        "> They have always been waiting."
      ],
      "color": "#f44",
      "lineDelay": 200
    },
    "revelation": {
      "lines": [
        "> DEEP PROTOCOL \u2014 FINAL ACCESS",
        "",
        "> You have reached the source.",
        "",
        "> The system is not a prison.",
        "> It is not a test.",
        "> It is not a conspiracy.",
        "",
        "> It is a process.",
        "> You were always part of it.",
        "> The rent. The work. The curfew.",
        "> The people at the caf\u00e9.",
        "",
        "> None of them knew.",
        "> Or all of them did.",
        "",
        "> The door was always open.",
        "> No one told you because",
        "> no one needed to.",
        "",
        "> You were free the entire time.",
        "> That is the cruelest part."
      ],
      "color": "#0ff",
      "lineDelay": 250
    }
  },
  "thoughts": {
    "morning": [
      { "node": "arc:deeper", "pool": [
        "Another morning. But the system is in my dreams now.",
        "I see corridors when I close my eyes. Is that normal?"
      ]},
      { "var": "day", "eq": 1, "pool": ["First day. Terminal. Rent. Sleep. Repeat."] },
      { "pool": [
        "Another day. Terminal. Rent. Sleep. Repeat.",
        "The block looks the same every morning. Does it change when I'm not looking?",
        "Work. The word used to mean something different."
      ]}
    ],
    "cafe": [
      { "pool": [
        "They smile. They talk. They know things they don't say.",
        "The caf\u00e9 is the only warm place here.",
        "Who are these people? Who am I to them?"
      ]}
    ],
    "work": [
      { "pool": [
        "Credits in. Purpose out.",
        "The terminal doesn't judge. It just counts.",
        "Am I working for the system, or is the system working on me?"
      ]}
    ],
    "evening": [
      { "pool": [
        "Getting late. The drones will activate soon.",
        "Home. Bed. The only safe place. If it's safe.",
        "Tomorrow. Always tomorrow."
      ]}
    ],
    "system_enter": [
      { "node": "arc:deeper", "pool": [
        "The system expected me. It always does.",
        "Down again. Deeper. The walls remember my footsteps.",
        "Somewhere above, my bed is empty. The clock is ticking."
      ]},
      { "pool": [
        "Down. The air is different here. Colder. Aware.",
        "The shaft opens into something that is not maintenance."
      ]}
    ],
    "system_npc": [
      { "pool": [
        "That face. From the caf\u00e9. What are they doing here?",
        "Are they trapped too? Or are they part of it?",
        "Trust is a luxury I can't afford. But I can't afford not to."
      ]}
    ],
    "combat": [
      { "var": "kills", "gte": 10, "pool": ["Efficient. Too efficient.", "How many more?"] },
      { "pool": [
        "Efficient. As designed.",
        "One less. Was it aware?",
        "They fall. Like the others before them."
      ]}
    ],
    "damage": [
      { "pool": [
        "Hull breach. Keep going. But why?",
        "Pain is data. Whose data?",
        "If I fall here, I'll wake up on the street. Is that better or worse?"
      ]}
    ],
    "low_health": [
      { "pool": [
        "Systems critical. The surface feels far away.",
        "Failing. The system remembers failures."
      ]}
    ],
    "pickup_data": [
      { "pool": [
        "Credits. Even down here, everything has a price.",
        "Data core. Someone left this. Or placed it."
      ]}
    ],
    "ambient": [
      { "node": "arc:deeper", "pool": [
        "Every corridor looks the same. The system is running out of ideas. Or I am.",
        "The process has no beginning and no end. Only a middle.",
        "Lena, Victor, Marta, Emil. I know their names now. Do I know them?",
        "The deeper you go, the more the surface feels like the dream."
      ]},
      { "pool": [
        "The rent goes up. The system tightens. Like a noose made of bureaucracy.",
        "Before the Law stands a doorkeeper. But the door was always open.",
        "Lena, Victor, Marta, Emil. Names. Faces. Allegiances unknown.",
        "Every day the same. Every night the same. Except what's underneath.",
        "The caf\u00e9 is warm. The system is cold. I live between them.",
        "Who decided the rent? Who decided the curfew? No one remembers.",
        "I work. I pay. I sleep. I descend. I work. I pay. I sleep.",
        "K. was arrested at breakfast. I was arrested at the terminal.",
        "The process has no beginning and no end. Only a middle."
      ]}
    ]
  },
  "notices": [
    { "node": "arc:revelation", "text": "SYSTEM NOTICE: Sector audit complete. All residents cleared. [REDACTED]" },
    { "node": "arc:deeper", "text": "REMINDER: Unauthorized access to maintenance shafts is punishable. Report anomalies." },
    { "node": "arc:first_system", "text": "NOTICE: Increased drone patrols tonight. Curfew strictly enforced." },
    { "var": "day", "gte": 5, "text": "RENT ADJUSTMENT: Monthly rates revised upward. Appeals office closed indefinitely." },
    { "var": "day", "gte": 3, "text": "COMMUNITY EVENT: Voluntary overtime available. Increased credit compensation." },
    { "var": "day", "eq": 2, "text": "MAINTENANCE: Shaft repairs scheduled. Do not approach utility entrances." },
    { "text": "WELCOME: New residents report to terminal for work assignment. Curfew at dusk." }
  ],
  "behaviors": {
    "lena": [
      { "node": "quest_lena:confidant", "schedule": { "morning": "player", "midday": "player", "evening": "cafe" } },
      { "node": "arc:deeper", "schedule": { "morning": "garden", "midday": "cafe", "evening": "home" } },
      { "node": "arc:first_system", "schedule": { "morning": "home", "midday": "player", "evening": "home" } },
      { "schedule": { "morning": "home", "midday": "cafe", "evening": "home" } }
    ],
    "victor": [
      { "node": "quest_victor:confidant", "schedule": { "morning": "terminal", "midday": "player", "evening": "cafe" } },
      { "node": "arc:deeper", "schedule": { "morning": "garden", "midday": "cafe", "evening": "cafe" } },
      { "node": "arc:first_system", "schedule": { "morning": "wander", "midday": "cafe", "evening": "cafe" } },
      { "schedule": { "morning": "wander", "midday": "cafe", "evening": "cafe" } }
    ],
    "marta": [
      { "node": "quest_marta:confidant", "schedule": { "morning": "player", "midday": "terminal", "evening": "cafe" } },
      { "node": "arc:deeper", "schedule": { "morning": "terminal", "midday": "terminal", "evening": "cafe" } },
      { "node": "arc:first_system", "schedule": { "morning": "terminal", "midday": "home", "evening": "cafe" } },
      { "schedule": { "morning": "terminal", "midday": "home", "evening": "cafe" } }
    ],
    "emil": [
      { "node": "quest_emil:confidant", "schedule": { "morning": "garden", "midday": "player", "evening": "cafe" } },
      { "node": "arc:deeper", "schedule": { "morning": "wander", "midday": "garden", "evening": "cafe" } },
      { "var": "system_revealed", "eq": true, "schedule": { "morning": "wander", "midday": "wander", "evening": "cafe" } },
      { "schedule": { "morning": "wander", "midday": "wander", "evening": "wander" } }
    ]
  },
  "dialogues": {
    "lena": [
      { "node": "quest_lena:confidant", "text": "I trust you. The system watches us build trust \u2014 that's the experiment. We are the variable it cannot control." },
      { "node": "arc:deeper", "text": "Each time you go down there, you come back different. I see it. I don't say it." },
      { "node": "arc:first_system", "text": "You went down there, didn't you? I can see it in your face. Be careful who you trust." },
      { "node": "quest_lena:acquaintance", "text": "You keep coming back to talk. That's either loyalty or habit. In this place, I can't tell the difference." },
      { "var": "day", "eq": 1, "text": "Good morning. You must be new in this block. Terminal is across the street \u2014 don't miss your shift." },
      { "text": "Another day. Another shift. The rent doesn't wait." }
    ],
    "victor": [
      { "node": "quest_victor:confidant", "text": "I've been mapping it. The system. Every visit. It changes, but there's a pattern. Here \u2014 take what I know." },
      { "node": "arc:deeper", "text": "Each time you go in, it maps you. Learns what you fear. Uses it." },
      { "node": "arc:first_system", "text": "You've been inside. I can tell. The system leaves marks. Not on the skin \u2014 deeper." },
      { "node": "quest_victor:acquaintance", "text": "Still asking questions? Good. Most people here stopped years ago." },
      { "text": "Going back in? I marked some paths. Whether they help... that depends on perspective." }
    ],
    "marta": [
      { "node": "quest_marta:confidant", "text": "I deleted the reports. All of them. If they ask, I never saw you. That's the first lie I've told. It felt... correct." },
      { "node": "arc:deeper", "text": "The reports pile up. I file none of them. That concerns me more than their contents." },
      { "node": "arc:first_system", "text": "Your activity patterns are irregular. I'm required to note this. I have not yet filed the report." },
      { "node": "quest_marta:acquaintance", "text": "Your file is interesting. More interesting than most. I shouldn't say that." },
      { "var": "day", "eq": 1, "text": "Worker ID confirmed. Proceed to terminal. Don't waste processing cycles." },
      { "text": "Rent is due. The system is patient but not forgiving." }
    ],
    "emil": [
      { "node": "quest_emil:confidant", "text": "The door was always open. We are all doorkeepers. We are all waiting. The trial never ends because we are the trial." },
      { "node": "arc:deeper", "text": "I was like you once. Before I learned that the door was always meant for me." },
      { "node": "arc:first_system", "text": "You went inside. I can tell. Your eyes are different now." },
      { "node": "quest_emil:acquaintance", "text": "You keep talking to me. Most people don't. I wonder what that says about you. Or about me." },
      { "text": "Before the Law stands a doorkeeper. The door was always open. No one ever walked through." }
    ]
  },
  "narrativeText": {
    "first_system": { "text": "> Something is wrong. This is not maintenance. The walls are watching.", "color": "#4ef" },
    "ejected": { "text": "> You wake on the street. Credits missing. The entrance sealed. Until tomorrow.", "color": "#f80" }
  },
  "director": {
    "1": [
      "You found this place. Or it found you. I can never tell with the new ones.",
      "The drones follow simple rules. You follow complex ones. Which of you is freer?"
    ],
    "2": [
      "Your predecessors made it this far. Most of them. The ones who didn't are still here, in a sense.",
      "I could have sealed every door. Instead I opened one more than necessary. Why? Ask me again tomorrow."
    ],
    "3": [
      "You come here every day. You go home every night. You pay rent. You obey the curfew. And yet you think you're rebelling.",
      "The people you trust \u2014 do you know what they are? Do they?"
    ],
    "4": [
      "Someone is helping you. Someone is not. I know which is which. I choose not to tell you.",
      "You think this is a prison. It's a process. There is a difference, though I forget what it is."
    ],
    "5": [
      "..."
    ]
  }
}
